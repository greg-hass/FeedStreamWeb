(()=>{"use strict";self.addEventListener("push",e=>{if(e.data)try{let t=e.data.json(),n=t.title||"New Article",i={body:t.body||"You have a new article to read",icon:"/icon-192.png",badge:"/icon-192.png",tag:t.tag||"article-notification",data:{url:t.url||"/",articleId:t.articleId}};e.waitUntil(self.registration.showNotification(n,i))}catch(e){console.error("Push notification error:",e)}}),self.addEventListener("notificationclick",e=>{e.notification.close();let t=e.notification.data?.url||"/";e.waitUntil(self.clients.matchAll({type:"window",includeUncontrolled:!0}).then(e=>{for(let n of e)if(n.url.includes(self.location.origin)&&"focus"in n)return n.navigate(t),n.focus();if(self.clients.openWindow)return self.clients.openWindow(t)}))}),self.addEventListener("pushsubscriptionchange",()=>{console.log("Push subscription changed - may need to re-subscribe")});let e=[".jpg",".jpeg",".png",".gif",".webp",".svg",".ico"];self.addEventListener("fetch",t=>{let n=new URL(t.request.url),i=e.some(e=>n.pathname.toLowerCase().endsWith(e)),o=n.pathname.startsWith("/api/proxy"),a=n.hostname.includes("google.com")&&n.pathname.includes("favicons"),s=n.hostname.includes("ytimg.com")||n.hostname.includes("ggpht.com");"GET"===t.request.method&&(i||o||a||s)&&t.respondWith(caches.open("article-thumbnails-v1").then(async e=>{let n=await e.match(t.request),i=fetch(t.request).then(n=>(n.ok&&e.put(t.request,n.clone()),n)).catch(()=>null);return n||i}))})})();